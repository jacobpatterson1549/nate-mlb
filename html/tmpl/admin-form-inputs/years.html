{{define "years"}}
<fieldset>
    <legend>Years</legend>
    <template id="year-template">
        <div class="form-group form-check my-3" id="year-0">
            <input class="year-radio form-check-input" type="radio" name="year-active" id="year-0-active">
            <label class="year-label form-check-label" for="year-0-active">?</label>
            <input class="year-input" type="hidden" name="year" value="?">
            <button class="btn btn-danger" type="button" title="Remove" onclick="removeYear()">Ã—</button>
        </div>
    </template>
    <div id="years">
    </div>
</fieldset>
<div class="form-inline my-3">
    <button class="btn btn-secondary mr-2" type="button" title="Add Year" onclick="addYear()">Add Year</button>
    <input id="add-year-input" class="form-control" type="number" min="2000" max="3000" , step="1">
</div>
<script>
    function removeYear() {
        var year = event.target.parentNode;
        var removedYearChecked = year.querySelector('.year-radio').checked;
        year.remove();
        if (removedYearChecked) {
            var yearsParent = document.getElementById('years');
            var yearRadios = yearsParent.querySelectorAll('.year-radio');
            if (yearRadios.length > 0) {
                yearRadios[yearRadios.length - 1].checked = true;
            }
        }
    }

    function addYear() {
        var yearsParent = document.getElementById('years');
        var year = document.getElementById('add-year-input').value;
        var years = yearsParent.children;
        for (var i = 0; i < years.length; i++) {
            var yearI = years[i].querySelector('.year-input').value;
            if (yearI === year) {
                return;
            }
        }
        createYear(year, true);
    }

    function createYear(yearNum, active) {
        var template = document.getElementById("year-template");
        var clone = document.importNode(template.content, true);
        var newYear = clone.querySelector('.form-check');
        newYear.id = 'year-' + yearNum;
        newYear.querySelector('.year-radio').id = 'year-' + yearNum + '-active';
        newYear.querySelector('.year-radio').value = yearNum;
        if (active == true) {
            newYear.querySelector('.year-radio').checked = true;
        }
        newYear.querySelector('.year-label').htmlFor = 'year-' + yearNum + '-active';
        newYear.querySelector('.year-label').innerText = yearNum;
        newYear.querySelector('.year-input').value = yearNum;
        var years = document.getElementById("years");
        years.appendChild(clone);
    }

    {{range .Data -}}
        createYear({{- .Value -}}, {{- .Active -}});
    {{end -}}
    document.getElementById('add-year-input').value = new Date().getYear() + 1900;
</script>
{{end}}